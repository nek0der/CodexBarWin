<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="CodexBarWin.Controls.ProviderCard"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:CodexBarWin.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid
        Padding="12,10"
        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
        BorderThickness="1"
        CornerRadius="6"
        PointerPressed="OnCardClicked">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- Header: Icon, Name, Status indicator -->
            <RowDefinition Height="Auto"/>  <!-- Session bar section -->
            <RowDefinition Height="Auto"/>  <!-- Weekly bar section -->
            <RowDefinition Height="Auto"/>  <!-- Error message -->
        </Grid.RowDefinitions>

        <!-- Header: Icon, Name, Status indicator -->
        <Grid Grid.Row="0" Margin="0,0,0,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Icon and Name -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                <Viewbox
                    Width="16"
                    Height="16"
                    Margin="0,0,8,0"
                    VerticalAlignment="Center">
                    <PathIcon x:Name="ProviderIcon" Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                </Viewbox>
                <TextBlock
                    x:Name="ProviderName"
                    FontWeight="SemiBold"
                    FontSize="13"
                    VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Status indicator (right aligned) -->
            <Grid Grid.Column="2" VerticalAlignment="Center">
                <!-- Normal state: green dot -->
                <Ellipse
                    x:Name="StatusNormal"
                    Width="8"
                    Height="8"
                    Fill="#10B981"
                    Visibility="Collapsed"/>
                <!-- Loading state: small spinner -->
                <ProgressRing
                    x:Name="StatusLoading"
                    Width="14"
                    Height="14"
                    IsActive="True"
                    Visibility="Collapsed"/>
                <!-- Error state: orange dot -->
                <Ellipse
                    x:Name="StatusError"
                    Width="8"
                    Height="8"
                    Fill="#F59E0B"
                    Visibility="Collapsed"/>
            </Grid>
        </Grid>

        <!-- Session bar section -->
        <Grid Grid.Row="1" x:Name="SessionSection" Margin="0,0,0,6">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Bar with label -->
                <RowDefinition Height="Auto"/>  <!-- Percent and time -->
            </Grid.RowDefinitions>

            <!-- Bar with label on right -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <local:UsageMeter
                    Grid.Column="0"
                    x:Name="SessionMeter"
                    Height="8"
                    VerticalAlignment="Center"/>
                <TextBlock
                    Grid.Column="1"
                    x:Name="SessionLabelText"
                    Text="Session"
                    Margin="8,0,0,0"
                    Style="{StaticResource CaptionTextBlockStyle}"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    VerticalAlignment="Center"
                    MinWidth="48"
                    TextAlignment="Right"/>
            </Grid>

            <!-- Percent (left) and time (right) -->
            <Grid Grid.Row="1" Margin="0,3,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock
                    Grid.Column="0"
                    x:Name="SessionPercentText"
                    FontSize="11"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    VerticalAlignment="Center"/>
                <TextBlock
                    Grid.Column="2"
                    x:Name="SessionTimeText"
                    Style="{StaticResource CaptionTextBlockStyle}"
                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                    VerticalAlignment="Center"/>
            </Grid>
        </Grid>

        <!-- Weekly bar section -->
        <Grid Grid.Row="2" x:Name="WeeklySection" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Bar with label -->
                <RowDefinition Height="Auto"/>  <!-- Percent and time -->
            </Grid.RowDefinitions>

            <!-- Bar with label on right -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <local:UsageMeter
                    Grid.Column="0"
                    x:Name="WeeklyMeter"
                    Height="8"
                    VerticalAlignment="Center"/>
                <TextBlock
                    Grid.Column="1"
                    x:Name="WeeklyLabelText"
                    Text="Weekly"
                    Margin="8,0,0,0"
                    Style="{StaticResource CaptionTextBlockStyle}"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    VerticalAlignment="Center"
                    MinWidth="48"
                    TextAlignment="Right"/>
            </Grid>

            <!-- Percent (left) and time (right) -->
            <Grid Grid.Row="1" Margin="0,3,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock
                    Grid.Column="0"
                    x:Name="WeeklyPercentText"
                    FontSize="11"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    VerticalAlignment="Center"/>
                <TextBlock
                    Grid.Column="2"
                    x:Name="WeeklyTimeText"
                    Style="{StaticResource CaptionTextBlockStyle}"
                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                    VerticalAlignment="Center"/>
            </Grid>
        </Grid>

        <!-- Error message (shown when error occurs, even with cached data) -->
        <Grid Grid.Row="3" x:Name="ErrorPanel" Visibility="Collapsed" Margin="0,4,0,0">
            <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                <FontIcon
                    FontFamily="Segoe Fluent Icons"
                    Glyph="&#xE7BA;"
                    FontSize="11"
                    Foreground="{ThemeResource SystemFillColorCautionBrush}"/>
                <TextBlock
                    x:Name="ErrorText"
                    FontSize="10"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </StackPanel>
        </Grid>

    </Grid>
</UserControl>
